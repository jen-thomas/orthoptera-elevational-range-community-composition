# Investigating the relationship of elevation and Orthoptera species richness, elevational range and community composition. 

This repository contains the code to do the analysis for this project. The analysis was done in `R`, but Python was used to create the Frictionless Data package (described below). 

## Project structure

The code structure is a balance between trying to use functions to keep the code organised, and putting it together in a logical order so that when looking at the HTML files, there is not too much moving around within and between scripts. 

A virtual environment `Renv` encapsulates the packages used within the code. This should be activated before trying to use the analysis code.

### Analysis scripts

The directory `analysis_scripts` contains the R code to manipulate the data and do the analysis needed for each hypothesis. Running the script `generate_analysis_output.R` will create HTML files from each of the individual files. This provides a more human-friendly view of the comments, code and output. Output files (HTML and plot files that are generated) are not included in this repository because they can be generated by running the code. 

Contents of `analysis_scripts`: 
* `data_preparation.R`: various data manipulation functions which prepares the data for analysis
* `get_finalised_observations_species_richness_conservative.R`: read the details about finalised observations in the file. This code creates the set of observations that are used for the rest of the analysis
* `get_physical_site_data.R`: digital elevation models were used to get data for topography parameters at each of the study sites
* `orthoptera_community_composition_hypothesis3.R`: analysis of community composition using `vegan`. Non-hierarchical K-means cluster analysis and NMDS with ordination.
* `orthoptera elevation_data_exploration.R`: initial investigations of the data to summarise visits to sites, number of surveys and number of taxa found
* `orthoptera_elevational_range_hypothesis2.R`: nonlinear regressions used to analyse the relationship between elevational range over an elevational gradient (Rapoport's elevational rule)
* `orthoptera_species_richness_hypothesis1.R`: generalised linear models used to find the important predictors of species richness along the elevational gradient
* `prepare_vegetation_data.R`: vegetation structure was characterised along each transect. This code calculates the mean of each parameter for each transect
* `utils.R`: some generic bits of code that can be used throughout the analysis

### Data

The directory `data` was used as the source of all of the data files that are used in the analysis. The data created as part of this project is now held in another repository, and data produced by other sources (digital elevation models) is not made available here for licensing reasons. For practical reasons, it would make sense to copy the required data to this directory when running the code, although it has been omitted from this repository to keep it separate from the code.

#### Digital elevation model data

The data required to reproduce this analysis can be obtained from the Institut Cartogràfic i Geològic de Catalunya at http://www.icc.cat/appdownloads/index.html?c=dlfxmde2m (data were downloaded in June 2022). Specific locations for each of the transects can be found in the `metadata` directory within this repository. Data should be downloaded to include each of the transects at a site, with a buffer of around 100m. The code uses the data within +/- 2 raster cells along the transect, where each cell measures 2x2m. 



